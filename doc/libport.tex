\documentclass{gostai-report}

\newenvironment{workaround}{\paragraph{Workaround}}{}

\title{Gostai Libport}
\subtitle{Version \VcsDescription}
\author{Gostai}

\begin{document}
\maketitle

\chapter{Portability issues}

\section{Windows}

\subsection{Test suite}

The Libport test suite uses Boost.UnitTest.  While our builds (that
aim for a static linking of the Boost libraries) rely on the absence
of the Boost dlls in the library directory, this breaks the UnitTest
framework.

So we need \file{boost_unit_test_framework-vc*.*} files, not just
\file{libboost_unit_test_framework-vc.lib}.

\subsection{Killing processes}
\label{sec:win:kill}
Beware that the \command{kill} builtin from shells cannot kill Windows
processes, use \command{/bin/kill}.  Use the following shell function
for \command{killall}.

\begin{shell}
killall ()
{
  ps -W |
    perl -ne '
    BEGIN { $re = join "|", qw ('"$*"'); };
    /\s*(\d+).*(?:$re)/ && push @res, $1;
    END { print "@res\n"; print STDERR "$re: @res\n"; };' |
    xargs /bin/kill -f
}
\end{shell}

\subsection{Crashes}

Windows features an ``automatic bug reporting'' system that pops-up a
window and expects user interaction.  Many such windows can stack up
and consume resources (and the guilty process is still present).

To prevent such windows:

panneau de config; System; Advanced; Error Report; desactivate +
disable "But Notify...".

The process that displays the window is \command{dwwin.exe}.  It can
be killed (\autoref{sec:win:kill}).

\section{MSVC}

\subsection{error C2883}
MSVC 2005 dies on the following piece of code:

\begin{cxx}
#include <iostream>
#define ECHO(S) std::cerr << #S << std::endl

namespace libport
{
  struct Top
  {
    virtual ~Top() {}
    virtual void foo(int)    { ECHO(Top::foo(int)); }
    virtual void foo(double) { ECHO(Top::foo(double)); }
  };
}

int
main ()
{
  struct Bot : libport::Top
  {
    using Top::foo;
    virtual ~Bot() {}
    virtual void foo(double) { ECHO(Bot::foo(double)); }
  };

  Bot b;
  b.foo(12);
  b.foo(1.2);
}
\end{cxx}

\begin{shell}
$ cl.exe using.cc -o using
using.cc:21: error C2883: 'main::Bot::foo' :
                           function declaration conflicts with
                           'libport::Top::foo'
                           introduced by using-declaration
using.cc:10: note:         see declaration of 'libport::Top::foo'
\end{shell}

\begin{workaround}
  Extract the struct from the function.
\end{workaround}
\end{document}
